name: CI for Fakestore
on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]



jobs:
  symfony:
    name: Symfonyfakestore
    # https://hub.docker.com/_/ubuntu/
    runs-on: ubuntu-latest
    env:
      APP_ENV: ${{secrets.APP_ENV}}
      APP_SECRET: ${{secrets.APP_SECRET}}
      DATABASE_URL: ${{secrets.DATABASE_URL}}
      COMPOSE_PROJECT_NAME: ${{secrets.COMPOSE_PROJECT_NAME}}
      REDIS_URL: ${{secrets.REDIS_URL}}
      DB_USERNAME: ${{secrets.DB_USERNAME}}
      DB_PASSWORD: ${{secrets.DB_PASSWORD}}
      DB_ROOT_PASSWORD: ${{secrets.DB_ROOT_PASSWORD}}
      MESSENGER_TRANSPORT_DSN: ${{secrets.MESSENGER_TRANSPORT_DSN}}
      MAILER_DSN: ${{secrets.MAILER_DSN}}
      MAILER_FROM: ${{secrets.MAILER_FROM}}
      RABBITMQ_USER: ${{secrets.RABBITMQ_USER}}
      RABBITMQ_PASSWORD: ${{secrets.RABBITMQ_PASSWORD}}
      JWT_SECRET_KEY: ${{secrets.JWT_SECRET_KEY}}
      JWT_PUBLIC_KEY: ${{secrets.JWT_PUBLIC_KEY}}
      JWT_PASSPHRASE: ${{secrets.JWT_PASSPHRASE}}
      CORS_ALLOW_ORIGIN: ${{secrets.CORS_ALLOW_ORIGIN}}

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Build docker Project
        run:  make dc_build && make dc_fix_perm && make dc_up
        with:
          options: -v ${{ github.workspace }}:/var/www

      ## â€”â€” JWT ðŸ’« â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      - name: Generate the SSL keys
        run: bin/console lexik:jwt:generate-keypair

      - name: PHPCS fixer
        run: make php-cs-fixer

